(function () {
    
    "use strict";

    var fluid = require("infusion"),
        path = require("path"),
        fs = require("fs"),
        os = require("os"),
        gpii = fluid.registerNamespace("gpii");

    fluid.defaults("gpii.journal", {
        gradeNames: ["fluid.littleComponent", "autoInit"],
        invokers: {
            logSolutionStart: {
                funcName: "gpii.journal.logSolutionStart",
                args: []
            }
        }
    });

    gpii.journal.logSolutionStart = function(msg) {
        fluid.log("GPII Journal: " + msg);
        var journalFilename = gpii.journal.getJournalFilename();
        fs.appendFileSync(journalFilename, msg);
        fs.appendFileSync(journalFilename, '\n"""\n');
    };

    gpii.journal.getJournalFilename = function() {
        return gpii.journal.getGpiiDataDir() + path.sep + 'journal.txt';
    };

    gpii.journal.clearJournal = function() {
        fs.unlinkSync(gpii.journal.getJournalFilename());
    };

    gpii.journal.getGpiiDataDir = function() {
        var dataDirName = "";
        if (os.platform() === "win32") {
            if (!fs.existsSync(process.env.APPDATA)) {
                console.error("the APPDATA directory on windows is missing");
            }
            dataDirName = process.env.APPDATA+path.sep+"gpii";
            if (!fs.existsSync(dataDirName)) {
                fs.mkdirSync(dataDirName);
            }
        }
        else {
            console.error("Need to add data dirs for non win32 platforms.");
        }
        return dataDirName;
    };
})();