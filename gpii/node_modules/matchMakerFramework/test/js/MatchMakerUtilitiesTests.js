/*!
GPII MatchMaker Utilities Tests

Copyright 2014 Raising The Floor - International

Licensed under the New BSD license. You may not use this file except in
compliance with this License.

The research leading to these results has received funding from the European Union's
Seventh Framework Programme (FP7/2007-2013) under grant agreement no. 289016.

You may obtain a copy of the License at
https://github.com/GPII/universal/blob/master/LICENSE.txt
*/

/*global jqUnit */

var fluid = fluid || require("infusion");
var gpii = fluid.registerNamespace("gpii");

(function () {
    "use strict";
    fluid.registerNamespace("gpii.tests.matchMakerUtilities");

    var transformSpec = {
        "http://registry\\.gpii\\.net/common/fontSize": "display.screenEnhancement.fontSize",
        "http://registry\\.gpii\\.net/common/foregroundColor": "display.screenEnhancement.foregroundColor",
        "http://registry\\.gpii\\.net/common/backgroundColor": "display.screenEnhancement.backgroundColor",
        "http://registry\\.gpii\\.net/common/fontFaceFontName": "display.screenEnhancement.fontFaceFontName",
        "http://registry\\.gpii\\.net/common/fontFaceGenericFontFace": "display.screenEnhancement.fontFaceGenericFontFace",
        "http://registry\\.gpii\\.net/common/magnifierEnabled": "display.screenEnhancement.-provisional-magnifierEnabled",
        "http://registry\\.gpii\\.net/common/magnification": "display.screenEnhancement.magnification",
        "http://registry\\.gpii\\.net/common/magnifierPosition": "display.screenEnhancement.-provisional-magnifierPosition",
        "http://registry\\.gpii\\.net/common/tracking": "display.screenEnhancement.tracking",
        "http://registry\\.gpii\\.net/common/trackingTTS": "display.screenEnhancement.trackingTTS",
        "http://registry\\.gpii\\.net/common/invertImages": "display.screenEnhancement.invertImages",
        "http://registry\\.gpii\\.net/common/invertColours": "display.screenEnhancement.-provisional-invertColours",
        "http://registry\\.gpii\\.net/common/cursorSize": "display.screenEnhancement.cursorSize",
        "http://registry\\.gpii\\.net/common/highContrastEnabled": "display.screenEnhancement.-provisional-highContrastEnabled",
        "http://registry\\.gpii\\.net/common/highContrastTheme": "display.screenEnhancement.-provisional-highContrastTheme",
        "http://registry\\.gpii\\.net/common/mouseTrailing": "display.screenEnhancement.mouseTrailing",
        "http://registry\\.gpii\\.net/common/screenReaderBrailleOutput": "display.screenReader.-provisional-screenReaderBrailleOutput",
        "http://registry\\.gpii\\.net/common/auditoryOutLanguage": "display.screenReader.-provisional-auditoryOutLanguage",
        "http://registry\\.gpii\\.net/common/speechRate": "display.screenReader.speechRate",
        "http://registry\\.gpii\\.net/common/speakTutorialMessages": "display.screenReader.-provisional-speakTutorialMessages",
        "http://registry\\.gpii\\.net/common/keyEcho": "display.screenReader.-provisional-keyEcho",
        "http://registry\\.gpii\\.net/common/wordEcho": "display.screenReader.-provisional-wordEcho",
        "http://registry\\.gpii\\.net/common/announceCapitals": "display.screenReader.-provisional-announceCapitals",
        "http://registry\\.gpii\\.net/common/punctuationVerbosity": "display.screenReader.-provisional-punctuationVerbosity",
        "http://registry\\.gpii\\.net/common/screenReaderTTSEnabled": "display.screenReader.-provisional-screenReaderTTSEnabled",
        "http://registry\\.gpii\\.net/common/pitch": "display.textReadingHighlight.pitch",
        "http://registry\\.gpii\\.net/common/readingUnit": "display.textReadingHighlight.readingUnit",
        "http://registry\\.gpii\\.net/common/volumeTTS": "display.textReadingHighlight.-provisional-volumeTTS",
        "http://registry\\.gpii\\.net/common/selfVoicingEnabled": "display.textReadingHighlight.-provisional-selfVoicingEnabled",
        "http://registry\\.gpii\\.net/common/brailleMode": "display.braille.-provisional-brailleMode",
        "http://registry\\.gpii\\.net/common/screenOffTime": "display.-provisional-screenOffTime",
        "http://registry\\.gpii\\.net/common/screenRotation": "display.-provisional-screenRotation",
        "http://registry\\.gpii\\.net/common/screenDefaultRotation": "display.-provisional-screenDefaultRotation",
        "http://registry\\.gpii\\.net/common/screenDim": "display.-provisional-screenDim",
        "http://registry\\.gpii\\.net/common/onScreenKeyboardEnabled": "control.onscreenKeyboard",
        "http://registry\\.gpii\\.net/common/initDelay": "control.mouseEmulation.-provisional-initDelay",
        "http://registry\\.gpii\\.net/common/cursorSpeed": "control.mouseEmulation.cursorSpeed",
        "http://registry\\.gpii\\.net/common/cursorAcceleration": "control.mouseEmulation.cursorAcceleration",
        "http://registry\\.gpii\\.net/common/mouseEmulationEnabled": "control.mouseEmulation.-provisional-mouseEmulationEnabled",
        "http://registry\\.gpii\\.net/common/stickyKeys": "control.keyboardEnhancement.stickyKeys",
        "http://registry\\.gpii\\.net/common/slowKeysInterval": "control.keyboardEnhancement.slowKeys.slowKeysInterval",
        "http://registry\\.gpii\\.net/common/slowKeysEnable": "control.keyboardEnhancement.slowKeys.-provisional-slowKeysEnable",
        "http://registry\\.gpii\\.net/common/debounceEnable": "control.keyboardEnhancement.debounceKeys.-provisional-debounceEnable",
        "http://registry\\.gpii\\.net/common/debounceInterval": "control.keyboardEnhancement.debounceKeys.debounceInterval",
        "http://registry\\.gpii\\.net/common/hapticFeedback": "control.-provisional-hapticFeedback",
        "http://registry\\.gpii\\.net/common/adaptationPreference": "content.adaptationPreference",
        "http://registry\\.gpii\\.net/common/showCrosshairs": "display.screenEnhancement.showCrosshairs",
        "http://registry\\.gpii\\.net/common/tableOfContents": "control.structuralNavigation.tableOfContents",
        "http://registry\\.gpii\\.net/common/volume": "-provisional-general.-provisional-volume",
        "http://registry\\.gpii\\.net/common/language": "language",
        "": {
            "transform": {
                "type": "gpii.ontologyHandler.transforms.applicationISOToFlat",
                "inputPath": "applications",
                "outputPath": ""
            }
        }
    };

    var apptologyTransformSpec = {
        "transform": [
            {
                "type": "fluid.transforms.value",
                "inputPath": "http://registry\\.gpii\\.net/common/magnifierEnabled",
                "outputPath": "http://registry\\.gpii\\.net/common/magnifierApplication"
            },
            {
                "type": "fluid.transforms.value",
                "inputPath": "http://registry\\.gpii\\.net/common/magnification",
                "outputPath": "http://registry\\.gpii\\.net/common/magnifierApplication"
            }
        ],
        "http://registry\\.gpii\\.net/common/screenReaderApplication": "http://registry\\.gpii\\.net/common/screenReaderTTSEnabled",
        "http://registry\\.gpii\\.net/common/stickyKeysApplication": "http://registry\\.gpii\\.net/common/stickyKeys",
        "http://registry\\.gpii\\.net/common/slowKeysApplication": "http://registry\\.gpii\\.net/common/slowKeysEnable",
        "http://registry\\.gpii\\.net/common/debounceKeysApplication": "http://registry\\.gpii\\.net/common/debounceEnable",
        "http://registry\\.gpii\\.net/common/onScreenKeyboardApplication": "http://registry\\.gpii\\.net/common/onScreenKeyboardEnabled"
    };

    var computeLeavesFixtures = [
        {
            description: "Nested structure including empty objects",
            model: {
                "display": {
                    "screenEnhancement": {
                        "fontSize": 24,
                        "foregroundColor": "white",
                        "backgroundColor": "black",
                        "fontFace": {
                            "genericFontFace": "sans serif"
                        },
                        "screenMagnification": {
                        }
                    }
                },
                "control": {
                    "structuralNavigation": {
                        "tableOfContents": false
                    }
                }
            },
            expected: [
                "display.screenEnhancement.fontSize",
                "display.screenEnhancement.foregroundColor",
                "display.screenEnhancement.backgroundColor",
                "display.screenEnhancement.fontFace.genericFontFace",
                "control.structuralNavigation.tableOfContents"
            ]
        }
    ];

    gpii.tests.matchMakerUtilities.computeLeaves = function () {
        fluid.each(computeLeavesFixtures, function (fixture) {
            var result = gpii.matchMakerFramework.utils.computeLeaves(fixture.model);
            jqUnit.assertDeepEq(fixture.name, fixture.expected, result);
        });
    };

    var pathsToSkeletonFixtures = [
        {
            description: "Object with various levels of nesting",
            expected: {
                "display": {
                    "screenEnhancement": {
                        "fontSize": {},
                        "foregroundColor": {},
                        "backgroundColor": {},
                        "fontFace": {
                            "genericFontFace": {}
                        }
                    },
                    "hello": {}
                },
                "control": {
                    "structuralNavigation": {
                        "tableOfContents": {}
                    }
                },
                "cat": {}
            },
            model: [
                "display.screenEnhancement.fontSize",
                "display.screenEnhancement.foregroundColor",
                "display.screenEnhancement.backgroundColor",
                "display.screenEnhancement.fontFace.genericFontFace",
                "display.hello",
                "control.structuralNavigation.tableOfContents",
                "cat"
            ]
        }, {
            description: "Object with various levels of nesting",
            expected: {
                "display": {
                    "screenEnhancement": {
                        "fontSize": true,
                        "foregroundColor": true,
                        "backgroundColor": true,
                        "fontFace": {
                            "genericFontFace": true
                        }
                    },
                    "hello": true
                },
                "control": {
                    "structuralNavigation": {
                        "tableOfContents": true
                    }
                },
                "cat": true
            },
            model: [
                "display.screenEnhancement.fontSize",
                "display.screenEnhancement.foregroundColor",
                "display.screenEnhancement.backgroundColor",
                "display.screenEnhancement.fontFace.genericFontFace",
                "display.hello",
                "control.structuralNavigation.tableOfContents",
                "cat"
            ],
            value: true
        }
    ];

    gpii.tests.matchMakerUtilities.pathsToSkeleton = function () {
        fluid.each(pathsToSkeletonFixtures, function (fixture) {
            var result = gpii.matchMakerFramework.utils.pathsToSkeleton(fixture.model, fixture.value);
            jqUnit.assertDeepEq(fixture.name, fixture.expected, result);
        });
    };

    var computeAndOntologizeCapabilitiesFromSolutionFixture = {
        description: "solution incl capabilities and transformations",
        model: {
            "name": "GNOME Shell Magnifier",
            "contexts": {},
            "settingsHandlers": {
                "configuration": {
                    "type": "gpii.gsettings",
                    "options": {
                        "schema": "org.gnome.desktop.a11y.magnifier"
                    },
                    "capabilities": [
                        "http://registry\\.gpii\\.net/common/invertColours"
                    ],
                    "capabilitiesTransformations": {
                        "mag-factor": "http://registry\\.gpii\\.net/common/magnification",
                        "show-cross-hairs": "http://registry\\.gpii\\.net/common/showCrosshairs",
                        "transform": {
                            "type": "fluid.transforms.arrayToSetMembership",
                            "inputPath": "http://registry\\.gpii\\.net/common/tracking",
                            "presentValue": "proportional",
                            "missingValue": "none",
                            "options": {
                                "focus": "focus-tracking",
                                "caret": "caret-tracking",
                                "mouse": "mouse-tracking"
                            }
                        },
                        "screen-position": {
                            "transform": {
                                "type": "fluid.transforms.valueMapper",
                                "inputPath": "http://registry\\.gpii\\.net/common/magnifierPosition",
                                "defaultInputValue": "Custom",
                                "options": {
                                    "FullScreen": {
                                        "outputValue": "full-screen"
                                    },
                                    "Lens": {
                                        "outputValue": "full-screen"
                                    },
                                    "LeftHalf": {
                                        "outputValue": "left-half"
                                    },
                                    "RightHalf": {
                                        "outputValue": "right-half"
                                    },
                                    "TopHalf": {
                                        "outputValue": "top-half"
                                    },
                                    "BottomHalf": {
                                        "outputValue": "bottom-half"
                                    },
                                    "Custom": {
                                        "outputValue": "full-screen"
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "update": [
                "settings.configuration"
            ],
            "configure": [
                "settings.configuration"
            ],
            "restore": [
                "settings.configuration"
            ],
            "start": [
                {
                    "type": "gpii.launch.exec",
                    "command": "gsettings set org.gnome.desktop.a11y.applications screen-magnifier-enabled true"
                }
            ],
            "stop": [
                {
                    "type": "gpii.launch.exec",
                    "command": "gsettings set org.gnome.desktop.a11y.applications screen-magnifier-enabled false"
                }
            ],
            "isInstalled": [
                {
                    "type": "gpii.packageKit.find",
                    "name": "gnome-shell"
                }
            ]
        },
        expectedISO: [
            "display.screenEnhancement.tracking",
            "display.screenEnhancement.magnification",
            "display.screenEnhancement.showCrosshairs",
            "display.screenEnhancement.-provisional-invertColours",
            "display.screenEnhancement.-provisional-magnifierPosition"
        ],
        expectedApptology: [
            "http://registry\\.gpii\\.net/common/magnifierApplication"
        ]
    };

    gpii.tests.matchMakerUtilities.computeAndOntologizeCapabilitiesFromSolution = function () {
        var fixture = computeAndOntologizeCapabilitiesFromSolutionFixture;
        var flatToISOSpec = fluid.model.transform.invertConfiguration(transformSpec);

        var resultISO = gpii.matchMakerFramework.utils.computeAndOntologizeCapabilitiesFromSolution(fixture.model, flatToISOSpec);
        jqUnit.assertDeepEq(fixture.description, fixture.expectedISO, resultISO);

        var resultApptology = gpii.matchMakerFramework.utils.computeAndOntologizeCapabilitiesFromSolution(fixture.model, apptologyTransformSpec);
        jqUnit.assertDeepEq(fixture.description, fixture.expectedApptology, resultApptology);
    };

    var buildReturnPayloadFixtures = [
        {
            description: "Basic payloads",
            disposed: {
                "gpii-default": [
                    "mac.dummy"
                ]
            },
            fullModel: {
                "userToken": "mac",
                "preferences": {
                    "contexts": {
                        "gpii-default": {
                            "name": "Default preferences",
                            "preferences": {
                                "http://registry.gpii.net/common/fontSize": 16,
                                "http://registry.gpii.net/common/screenReaderTTSEnabled": false,
                                "http://registry.gpii.net/common/magnifierEnabled": false,
                                "http://registry.gpii.net/common/magnification": 1
                            }
                        }
                    }
                },
                "deviceReporter": {
                    "solutions": [
                        {
                            "id": "mac.dummy"
                        },
                        {
                            "id": "mac.dummy_empty"
                        }
                    ],
                    "OS": {
                        "id": "darwin",
                        "version": "12.5.0"
                    }
                },
                "solutionsRegistry": {
                    "mac.dummy": {
                        "name": "Mac dummy",
                        "contexts": {
                            "OS": [
                                {
                                    "id": "darwin"
                                }
                            ]
                        },
                        "settingsHandlers": {
                            "myconf": {
                                "type": "gpii.settingsHandlers.JSONSettingsHandler.set",
                                "options": {
                                    "path": "/path/to/some/file.json"
                                },
                                "capabilities": [],
                                "capabilitiesTransformations": {
                                    "setting1": "http://registry\\.gpii\\.net/common/fontSize",
                                    "setting2.path1": "http://registry\\.gpii\\.net/common/screenReaderTTSEnabled",
                                    "setting2.path2": "http://registry\\.gpii\\.net/common/magnifierEnabled",
                                    "setting2.path3.hello": "http://registry\\.gpii\\.net/common/magnification"
                                }
                            }
                        },
                        "configure": [
                            "settings.myconf"
                        ],
                        "restore": [
                            "settings.myconf"
                        ]
                    },
                    "mac.dummy_empty": {
                        "name": "Mac dummy empty",
                        "contexts": {
                            "OS": [
                                {
                                    "id": "darwin"
                                }
                            ]
                        },
                        "settingsHandlers": {
                            "otherconf": {
                                "type": "gpii.settingsHandlers.noSettings",
                                "capabilities": []
                            }
                        },
                        "start": [],
                        "stop": []
                    }
                },
                "activeContexts": [
                    "gpii-default"
                ],
                "environmentReporter": {},
                "inferredCommonTerms": {
                    "gpii-default": {}
                },
                "hierarchicalPrefs": {
                    "contexts": {
                        "gpii-default": {
                            "name": "Default preferences",
                            "preferences": {
                                "display": {
                                    "screenEnhancement": {
                                        "fontSize": 16,
                                        "magnification": 1,
                                        "-provisional-magnifierEnabled": false
                                    },
                                    "screenReader": {
                                        "-provisional-screenReaderTTSEnabled": false
                                    }
                                }
                            }
                        }
                    }
                }
            },
            expected: {
                "inferredConfiguration": {
                    "gpii-default": {
                        "applications": {
                            "mac.dummy": {
                                "active": true,
                                "settings": {
                                    "http://registry.gpii.net/common/fontSize": 16,
                                    "http://registry.gpii.net/common/screenReaderTTSEnabled": false,
                                    "http://registry.gpii.net/common/magnifierEnabled": false,
                                    "http://registry.gpii.net/common/magnification": 1
                                }
                            }
                        }
                    }
                }
            }
        }
    ];

    gpii.tests.matchMakerUtilities.buildReturnPayload = function () {
        fluid.each(buildReturnPayloadFixtures, function (fixture) {
            var result = gpii.matchMakerFramework.utils.buildReturnPayload(fixture.fullModel, fixture.disposed);
            jqUnit.assertDeepEq(fixture.description, fixture.expected, result);
        });
    };


    var inferredCommonfixtures = [
        {
            name: "No existing prefs in original set",
            preferences: {
                "contexts": {
                    "gpii-default": {
                        "name": "Default preferences",
                        "preferences": {}
                    }
                }
            },
            inferred: {
                "gpii-default": {
                    "org.gnome.desktop.interface": {
                        "http://registry.gpii.net/common/fontSize": 9,
                        "http://registry.gpii.net/common/cursorSize": 0.9
                    },
                    "org.gnome.desktop.a11y.magnifier": {
                        "http://registry.gpii.net/common/magnification": 1.5,
                        "http://registry.gpii.net/common/magnifierPosition": "FullScreen"
                    }
                }
            },
            expect: {
                "contexts": {
                    "gpii-default": {
                        "name": "Default preferences",
                        "preferences": {
                            "http://registry.gpii.net/common/fontSize": 9,
                            "http://registry.gpii.net/common/cursorSize": 0.9,
                            "http://registry.gpii.net/common/magnification": 1.5,
                            "http://registry.gpii.net/common/magnifierPosition": "FullScreen"
                        }
                    }
                }
            }
        }, {
            name: "Existing prefs in original set, some being overwritten",
            preferences: {
                "contexts": {
                    "gpii-default": {
                        "name": "Default preferences",
                        "preferences": {
                            "http://registry.gpii.net/applications/org.gnome.desktop.interface": {
                                "cursor-size": 90,
                                "text-scaling-factor": 0.75
                            },
                            "http://registry.gpii.net/applications/org.alsa-project": {
                                "masterVolume": 50
                            },
                            "http://registry.gpii.net/common/cursorSize": 1
                        }
                    }
                }
            },
            inferred: {
                "gpii-default": {
                    "org.gnome.desktop.interface": {
                        "http://registry.gpii.net/common/fontSize": 9,
                        "http://registry.gpii.net/common/cursorSize": 0.9
                    },
                    "org.gnome.desktop.a11y.magnifier": {
                        "http://registry.gpii.net/common/magnification": 1.5,
                        "http://registry.gpii.net/common/magnifierPosition": "FullScreen"
                    }
                }
            },
            expect: {
                "contexts": {
                    "gpii-default": {
                        "name": "Default preferences",
                        "preferences": {
                            "http://registry.gpii.net/applications/org.gnome.desktop.interface": {
                                "cursor-size": 90,
                                "text-scaling-factor": 0.75
                            },
                            "http://registry.gpii.net/applications/org.alsa-project": {
                                "masterVolume": 50
                            },
                            "http://registry.gpii.net/common/fontSize": 9,
                            "http://registry.gpii.net/common/cursorSize": 1,
                            "http://registry.gpii.net/common/magnification": 1.5,
                            "http://registry.gpii.net/common/magnifierPosition": "FullScreen"
                        }
                    }
                }
            }
        }, {
            name: "Two instances of the same common term present in the inferred common terms",
            preferences: {
                "contexts": {
                    "gpii-default": {
                        "name": "Default preferences",
                        "preferences": {
                            "http://registry.gpii.net/common/cursorSize": 1
                        }
                    }
                }
            },
            inferred: {
                "gpii-default": {
                    "org.gnome.desktop.interface": {
                        "http://registry.gpii.net/common/fontSize": 9,
                        "http://registry.gpii.net/common/cursorSize": 0.9
                    },
                    "org.gnome.desktop.a11y.magnifier": {
                        "http://registry.gpii.net/common/fontSize": 1.5,
                        "http://registry.gpii.net/common/magnifierPosition": "FullScreen"
                    }
                }
            },
            expect: {
                "contexts": {
                    "gpii-default": {
                        "name": "Default preferences",
                        "preferences": {
                            "http://registry.gpii.net/common/fontSize": 9,
                            "http://registry.gpii.net/common/cursorSize": 1,
                            "http://registry.gpii.net/common/magnifierPosition": "FullScreen"
                        }
                    }
                }
            }
        }
    ];

    gpii.tests.matchMakerUtilities.testaddInferredCommonTerms = function () {
        jqUnit.module("Inferred common terms merging");
        fluid.each(inferredCommonfixtures, function (fixture) {
            var result = gpii.matchMakerFramework.utils.addInferredCommonTerms(fixture.preferences, fixture.inferred);
            jqUnit.assertDeepEq(fixture.name, fixture.expect, result);
        });
    };

    var addSolutionTypeInformationFixtures = [{
        name: "Three solutions, two of same type",
        payload: {
            solutionsRegistryEntries: {
                "fakemag1": {
                    "name": "Fake Magnifier 1",
                    "contexts": {
                        "OS": [
                            {
                                "id": "darwin"
                            }
                        ]
                    },
                    "settingsHandlers": {
                        "configuration": {
                            "type": "gpii.settingsHandlers.JSONSettingsHandler",
                            "options": {
                                "filename": "/tmp/fakemag1.settings.json"
                            },
                            "capabilities": [
                                "http://registry\\.gpii\\.net/common/magnifierEnabled"
                            ],
                            "capabilitiesTransformations": {
                                "magnification": "http://registry\\.gpii\\.net/common/magnification"
                            }
                        }
                    },
                    "configure": [
                        "settings.configuration"
                    ],
                    "restore": [
                        "settings.configuration"
                    ],
                    "start": [],
                    "stop": [],
                    "isInstalled": [
                        {
                            "type": "gpii.deviceReporter.alwaysInstalled"
                        }
                    ]
                },
                "fakemag2": {
                    "name": "Fake Magnifier 2 - fully featured",
                    "contexts": {
                        "OS": [
                            {
                                "id": "darwin"
                            }
                        ]
                    },
                    "settingsHandlers": {
                        "configuration": {
                            "type": "gpii.settingsHandlers.JSONSettingsHandler",
                            "options": {
                                "filename": "/tmp/fakemag2.settings.json"
                            },
                            "capabilities": [
                                "http://registry\\.gpii\\.net/common/magnifierEnabled"
                            ],
                            "capabilitiesTransformations": {
                                "magnification": "http://registry\\.gpii\\.net/common/magnification",
                                "invert": "http://registry\\.gpii\\.net/common/invertColours"
                            }
                        }
                    },
                    "configure": [
                        "settings.configuration"
                    ],
                    "restore": [
                        "settings.configuration"
                    ],
                    "start": [],
                    "stop": [],
                    "isInstalled": [
                        {
                            "type": "gpii.deviceReporter.alwaysInstalled"
                        }
                    ]
                },
                "fakescreenreader1": {
                    "name": "fake screenreader",
                    "contexts": {
                        "OS": [
                            {
                                "id": "darwin"
                            }
                        ]
                    },
                    "settingsHandlers": {
                        "configuration": {
                            "type": "gpii.settingsHandlers.JSONSettingsHandler",
                            "options": {
                                "filename": "/tmp/fakescreenreader1.json"
                            },
                            "capabilities": [
                                "http://registry\\.gpii\\.net/common/screenReaderTTSEnabled"
                            ],
                            "capabilitiesTransformations": {
                                "pitch": "http://registry\\.gpii\\.net/common/pitch",
                                "volumeTTS": "http://registry\\.gpii\\.net/common/volumeTTS",
                                "rate": "http://registry\\.gpii\\.net/common/speechRate"
                            }
                        }
                    },
                    "configure": [
                        "settings.configuration"
                    ],
                    "restore": [
                        "settings.configuration"
                    ],
                    "start": [],
                    "stop": [],
                    "isInstalled": [
                        {
                            "type": "gpii.deviceReporter.alwaysInstalled"
                        }
                    ]
                }
            }
        },
        expectedSolutionTypes: {
            "fakemag1": [
                "http://registry\\.gpii\\.net/common/magnifierApplication"
            ],
            "fakemag2": [
                "http://registry\\.gpii\\.net/common/magnifierApplication"
            ],
            "fakescreenreader1": [
                "http://registry\\.gpii\\.net/common/screenReaderApplication"
            ]
        },
        expectedSolutionTypeMapping: {
            "http://registry\\.gpii\\.net/common/magnifierApplication": {
                "fakemag1": true,
                "fakemag2": true
            },
            "http://registry\\.gpii\\.net/common/screenReaderApplication": {
                "fakescreenreader1": true
            }
        }
    }];

    gpii.tests.matchMakerUtilities.testAddSolutionTypeInformation = function () {
        jqUnit.module("AddSolutionTypeInformation tests");
        fluid.each(addSolutionTypeInformationFixtures, function (fixture) {
            var payload = fluid.copy(fixture.payload);
            gpii.matchMakerFramework.utils.addSolutionTypeInformation(payload, apptologyTransformSpec);
            jqUnit.assertDeepEq(fixture.name + ". Checking solutions types are properly added", fixture.expectedSolutionTypes, payload.solutionTypes);
            jqUnit.assertDeepEq(fixture.name + ". Checking solutions Mapping is properly added", fixture.expectedSolutionTypeMapping, payload.solutionTypeMapping);
        });
    };

    gpii.tests.matchMakerUtilities.runTests = function () {
        jqUnit.module("MatchMakerUtilities");
        jqUnit.test("Compute Leaves", gpii.tests.matchMakerUtilities.computeLeaves);
        jqUnit.test("Paths to Skeleton", gpii.tests.matchMakerUtilities.pathsToSkeleton);
        jqUnit.test("Compute Capabilities From Solution", gpii.tests.matchMakerUtilities.computeAndOntologizeCapabilitiesFromSolution);
        jqUnit.test("Build Return Payload", gpii.tests.matchMakerUtilities.buildReturnPayload);
        jqUnit.test("Merging inferred common terms with preferences", gpii.tests.matchMakerUtilities.testaddInferredCommonTerms);
        jqUnit.test("Adding solution type information to payload", gpii.tests.matchMakerUtilities.testAddSolutionTypeInformation);
    };
}());
